<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>AccessAble</title>

  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>

  <style>
    body { font-family: 'Inter', sans-serif; }
    .dyslexic {
      letter-spacing: 0.12em;
      word-spacing: 0.25em;
      line-height: 2;
    }
    .ruler {
      position: absolute;
      left: 0;
      right: 0;
      height: 45px;
      background: rgba(59,130,246,0.15);
      border-top: 2px solid #3b82f6;
      border-bottom: 2px solid #3b82f6;
      pointer-events: none;
    }
  </style>
</head>

<body class="bg-slate-100">
<div id="root"></div>

<script type="text/babel">

const { useState, useEffect } = React;

/* ---------------- AUTH COMPONENT ---------------- */

function Auth({ onLogin }) {
  const [mode, setMode] = useState("login");
  const [error, setError] = useState("");

  const accounts = JSON.parse(localStorage.getItem("accounts")) || [];

  function handleSubmit(e) {
    e.preventDefault();
    const { username, email, identifier, password } = e.target;

    if (mode === "signup") {
      const newAccount = {
        username: username.value,
        email: email.value,
        password: password.value
      };
      localStorage.setItem("accounts", JSON.stringify([...accounts, newAccount]));
      setMode("login");
      return;
    }

    const found = accounts.find(a =>
      (a.username === identifier.value || a.email === identifier.value)
      && a.password === password.value
    );

    if (found) {
      localStorage.setItem("currentUser", JSON.stringify(found));
      onLogin(found);
    } else {
      setError("Invalid credentials.");
    }
  }

  return (
    <div className="min-h-screen flex items-center justify-center">
      <div className="bg-white w-96 p-10 rounded-3xl shadow-xl">
        <h1 className="text-3xl font-bold mb-6 text-center">
          {mode === "login" ? "Login" : "Create Account"}
        </h1>

        {error && <p className="text-red-500 mb-4">{error}</p>}

        <form onSubmit={handleSubmit} className="space-y-4">
          {mode === "signup" && (
            <>
              <input name="username" required placeholder="Username" className="w-full p-3 bg-slate-100 rounded-xl"/>
              <input name="email" required type="email" placeholder="Email" className="w-full p-3 bg-slate-100 rounded-xl"/>
            </>
          )}
          <input name="identifier" required placeholder="Username or Email" className="w-full p-3 bg-slate-100 rounded-xl"/>
          <input name="password" required type="password" placeholder="Password" className="w-full p-3 bg-slate-100 rounded-xl"/>

          <button className="w-full py-3 bg-blue-600 text-white rounded-xl font-semibold">
            {mode === "login" ? "Login" : "Sign Up"}
          </button>
        </form>

        <button
          onClick={() => setMode(mode === "login" ? "signup" : "login")}
          className="mt-4 text-sm text-blue-600"
        >
          {mode === "login" ? "Need an account?" : "Already have one?"}
        </button>
      </div>
    </div>
  );
}

/* ---------------- SIDEBAR ---------------- */

function Sidebar({ notes, setActiveNote, createNote }) {
  return (
    <div className="w-72 bg-white border-r p-6">
      <button
        onClick={createNote}
        className="w-full mb-6 py-3 bg-blue-600 text-white rounded-xl font-semibold"
      >
        + New Note
      </button>

      <div className="space-y-3">
        {notes.map(note => (
          <div
            key={note.id}
            onClick={() => setActiveNote(note)}
            className="p-3 bg-slate-100 rounded-xl cursor-pointer hover:bg-slate-200"
          >
            {note.title}
          </div>
        ))}
      </div>
    </div>
  );
}

/* ---------------- TOOLBAR ---------------- */

function Toolbar({
  fontSize, setFontSize,
  contrast, setContrast,
  dyslexic, setDyslexic,
  rulerOn, setRulerOn,
  speed, setSpeed,
  speechState, toggleSpeech, stopSpeech,
  saveNote
}) {

  const themes = {
    light: "Light",
    dark: "Dark",
    high: "High Contrast"
  };

  return (
    <div className="flex flex-wrap gap-3 mb-4">
      <button onClick={() => setFontSize(f => f + 2)}>A+</button>
      <button onClick={() => setFontSize(f => Math.max(12, f - 2))}>A-</button>

      <button
        onClick={() =>
          setContrast(contrast === "light"
            ? "dark"
            : contrast === "dark"
            ? "high"
            : "light")
        }
      >
        {themes[contrast]}
      </button>

      <button onClick={() => setDyslexic(!dyslexic)}>
        Dyslexic
      </button>

      <button onClick={() => setRulerOn(!rulerOn)}>
        Ruler
      </button>

      <button onClick={toggleSpeech}>
        {speechState === "playing"
          ? "Pause"
          : speechState === "paused"
          ? "Resume"
          : "Listen"}
      </button>

      <button onClick={stopSpeech}>Stop</button>

      <button onClick={saveNote} className="bg-blue-600 text-white px-4 rounded-lg">
        Save
      </button>

      <div>
        Speed:
        <input
          type="range"
          min="0.5"
          max="2"
          step="0.1"
          value={speed}
          onChange={(e) => setSpeed(parseFloat(e.target.value))}
        />
      </div>
    </div>
  );
}

/* ---------------- MAIN APP ---------------- */

function App() {
  const [user, setUser] = useState(
    JSON.parse(localStorage.getItem("currentUser"))
  );

  const [notes, setNotes] = useState(
    JSON.parse(localStorage.getItem("notes")) || []
  );

  const [activeNote, setActiveNote] = useState({
    id: Date.now(),
    title: "Untitled",
    content: ""
  });

  const [fontSize, setFontSize] = useState(20);
  const [contrast, setContrast] = useState("light");
  const [dyslexic, setDyslexic] = useState(false);
  const [rulerOn, setRulerOn] = useState(false);
  const [rulerY, setRulerY] = useState(0);
  const [speed, setSpeed] = useState(1);
  const [speechState, setSpeechState] = useState("stopped");

  useEffect(() => {
    localStorage.setItem("notes", JSON.stringify(notes));
  }, [notes]);

  function createNote() {
    setActiveNote({
      id: Date.now(),
      title: "New Note",
      content: ""
    });
  }

  function saveNote() {
    const updated = notes.filter(n => n.id !== activeNote.id);
    setNotes([activeNote, ...updated]);
  }

  function toggleSpeech() {
    const synth = window.speechSynthesis;

    if (speechState === "stopped") {
      const utterance = new SpeechSynthesisUtterance(activeNote.content || "Nothing to read");
      utterance.rate = speed;
      utterance.onstart = () => setSpeechState("playing");
      utterance.onend = () => setSpeechState("stopped");
      synth.speak(utterance);
    } else if (speechState === "playing") {
      synth.pause();
      setSpeechState("paused");
    } else {
      synth.resume();
      setSpeechState("playing");
    }
  }

  function stopSpeech() {
    window.speechSynthesis.cancel();
    setSpeechState("stopped");
  }

  function logout() {
    localStorage.removeItem("currentUser");
    window.speechSynthesis.cancel();
    setUser(null);
  }

  const themeClasses = {
    light: "bg-white text-black",
    dark: "bg-black text-white",
    high: "bg-black text-yellow-400"
  };

  if (!user) return <Auth onLogin={setUser} />;

  return (
    <div className="h-screen flex flex-col">

      <div className="bg-white flex justify-between p-4 border-b">
        <input
          value={activeNote.title}
          onChange={(e) => setActiveNote({...activeNote, title: e.target.value})}
          className="border p-2 rounded-lg"
        />
        <button onClick={logout} className="text-red-500">Logout</button>
      </div>

      <div className="flex flex-1 overflow-hidden">
        <Sidebar
          notes={notes}
          setActiveNote={setActiveNote}
          createNote={createNote}
        />

        <div
          className="flex-1 p-6 relative"
          onMouseMove={(e) => {
            if (rulerOn) {
              setRulerY(e.clientY - e.currentTarget.getBoundingClientRect().top);
            }
          }}
        >
          {rulerOn && <div className="ruler" style={{ top: rulerY - 22 }}></div>}

          <Toolbar
            fontSize={fontSize} setFontSize={setFontSize}
            contrast={contrast} setContrast={setContrast}
            dyslexic={dyslexic} setDyslexic={setDyslexic}
            rulerOn={rulerOn} setRulerOn={setRulerOn}
            speed={speed} setSpeed={setSpeed}
            speechState={speechState}
            toggleSpeech={toggleSpeech}
            stopSpeech={stopSpeech}
            saveNote={saveNote}
          />

          <textarea
            className={`w-full h-[75%] p-6 rounded-2xl border ${themeClasses[contrast]} ${dyslexic ? "dyslexic" : ""}`}
            style={{ fontSize: fontSize }}
            value={activeNote.content}
            onChange={(e) =>
              setActiveNote({...activeNote, content: e.target.value})
            }
          />
        </div>
      </div>
    </div>
  );
}

ReactDOM.createRoot(document.getElementById("root")).render(<App />);

</script>
</body>
</html>

